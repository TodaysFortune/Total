<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.team.mapper.boardMapper"> 
 
  <select id="selectCount" resultType="int">
       select count(*) from itboard 
  </select>
  
  <select id="selectList" parameterType="java.util.HashMap" resultType="ITboardDTO">
        select * from itboard order by board_ref desc,board_seq asc limit #{startNo},#{noSize}
  </select>
    
   <select id="selectTypeCount" resultType="int" parameterType="ITboardList">
        select count(*) from itboard
        <where>
        	<choose>
	        	<when test='searchType.equals("all")'> <!-- 제목+본문 탐색수행 -->
	        		subject LIKE CONCAT('%',#{searchText},'%') OR content LIKE CONCAT('%',#{searchText},'%')
	        	</when>
	        	<otherwise>
		        	${searchType} LIKE CONCAT('%',#{searchText},'%')
	        	</otherwise>
        	</choose>
        </where>
  </select> 
  <select id="selectTypeList" parameterType="ITboardList" resultType="ITboardDTO">
        select * from itboard
        <where>
        	<choose>
	        	<when test='searchText.equals("")'> <!-- 텍스트에 아무것도 적지 않았을 경우 -->
	        		1=1
	        	</when>
	        	<when test='searchType.equals("all")'> <!-- 제목+본문 탐색수행 -->
	        		subject LIKE CONCAT('%',#{searchText},'%') OR content LIKE CONCAT('%',#{searchText},'%')
	        	</when>
	        	<otherwise>
	        		${searchType} LIKE CONCAT('%',#{searchText},'%')
	        	</otherwise>
        	</choose>
        </where> 
        <choose>
        	<when test='searchType.equals("recommendedNumber")'>
        		order by good desc,bidx desc limit #{startNo},#{noSize}
        	</when>
        	<otherwise>
        		order by bidx desc limit #{startNo},#{noSize}
        	</otherwise>
        </choose>
  </select>
  <select id="selectBoard" parameterType="int" resultType="ITboardDTO">
  	select * from itboard where bidx=#{_parameter}
  </select>
  <select id="selectGoodChecked" parameterType="java.util.Map" resultType="int">
  	select count(*) from itgood where bidx=#{bidx} and id=#{id}
  </select>
  <select id="selectGoodCount" parameterType="int" resultType="int">
  	select count(*) from itgood where bidx=#{_parameter}
  </select>
  <insert id="insertBoard" parameterType="ITboardDTO">
  		insert into itboard (bidx,id,name,subject,content,board_ref,board_lev,board_seq,board_hit,good) values
  		(boardnextval(#{category}),#{id},#{name},#{subject},#{content},boardcurval(#{category}),0,0,0,0)
  </insert>
  <insert id="updateGoodup" parameterType="java.util.Map">
  		insert into itgood (bidx,id) values (#{bidx},#{id})
  </insert>
  <delete id="updateGooddown" parameterType="java.util.Map">
  		delete from itgood where bidx=#{bidx} and id=#{id}
  </delete>
  <update id="incrementBoard" parameterType="int">
  		update itboard set board_hit=board_hit+1 where bidx=#{_parameter}
  </update>
  <update id="updateGooddownBoard" parameterType="int">
  		update itboard set good=good-1 where bidx=#{_parameter}
  </update>
  <update id="updateGoodupBoard" parameterType="int">
  		update itboard set good=good+1 where bidx=#{_parameter}
  </update>
</mapper>